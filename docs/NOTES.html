<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="author" content="Khomyakov Anton">
<title>Конспект по книге: "Python. К вершинам мастерства."</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1><em>Конспект по книге:</em> "Python. К вершинам мастерства."</h1>
<div class="details">
<span id="author" class="author">Khomyakov Anton</span><br>
<span id="email" class="email"><a href="mailto:mr.humster@gmail.com">mr.humster@gmail.com</a></span><br>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_глава_5_словари_и_множества">Глава 5. <em>Словари и множества</em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Все словари наследуют класс <strong>collections.abc.Mapping</strong>. Ключи должны быть хэшируемые. Включать метод <em>hash</em>() и <em>eq</em>()
Объект называется хэшируемым, если он обладает хэш-значением, которое не изменяется на протяжении всей жизни объекта и
допускает сравнение с другими объектами.</p>
</div>
<div class="listingblock">
<div class="title">Способы инициализации словаря</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">a = <span style="color:#369;font-weight:bold">dict</span>(one=<span style="color:#00D">1</span>, two=<span style="color:#00D">2</span>, three=<span style="color:#00D">3</span>)
b = {<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">one</span><span style="color:#710">'</span></span>: <span style="color:#00D">1</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">two</span><span style="color:#710">'</span></span>: <span style="color:#00D">2</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">three</span><span style="color:#710">'</span></span>: <span style="color:#00D">3</span>}
c = <span style="color:#369;font-weight:bold">dict</span>(<span style="color:#369;font-weight:bold">zip</span>([<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">one</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">two</span><span style="color:#710">'</span></span>,<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">three</span><span style="color:#710">'</span></span>],[<span style="color:#00D">1</span>,<span style="color:#00D">2</span>,<span style="color:#00D">3</span>]))
d = <span style="color:#369;font-weight:bold">dict</span>([(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">two</span><span style="color:#710">'</span></span>, <span style="color:#00D">2</span>), (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">one</span><span style="color:#710">'</span></span>, <span style="color:#00D">1</span>), (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">three</span><span style="color:#710">'</span></span>, <span style="color:#00D">3</span>)])
e = <span style="color:#369;font-weight:bold">dict</span>({<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">two</span><span style="color:#710">'</span></span>: <span style="color:#00D">2</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">one</span><span style="color:#710">'</span></span>: <span style="color:#00D">1</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">three</span><span style="color:#710">'</span></span>: <span style="color:#00D">3</span>})
a == b == c == d == e
<span style="color:#069">True</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_тексты_и_байты">Тексты и байты.</h3>
<div class="paragraph">
<p>Всё что нужно знать о байтах: главное это то, что существут 2 основных типа основных типа отображения двоичных
последовательностей: изменяемы тип bytes, появившийся в py3 и не изменяемы тип bytearray.
Каждый элемент bytes или bytearray - целое число от 0 до 255</p>
</div>
</div>
<div class="sect2">
<h3 id="_полноправные_функции">Полноправные функции</h3>

</div>
<div class="sect2">
<h3 id="_семь_видов_вызываемых_объектов">Семь видов вызываемых объектов</h3>
<div class="paragraph">
<p>Оператор () можно применять не только к функциям, определённым пользователями. Что бы понять является ли объект вызываемым, воспользуейтесь функцией:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#369;font-weight:bold">callable</span>()</code></pre>
</div>
</div>
<table class="tableblock frame-none grid-rows stretch">
<caption class="title">Table 1. Вызываемые элементы Python</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Функция</th>
<th class="tableblock halign-left valign-top">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Пользовательские функции</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Создаются при помощи выражения <code>def</code> или <code>lambda</code>-выражения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Встроенные функции</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Функции написанные на C (в случае CPython), например <code>len</code> или <code>time.strftime</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Методы</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Функции определённые в теле класса</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Встроенные методы</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Метода написанные на C, например dict.get</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Классы</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">При вызове класса выполняется свой метод <code><em>new</em></code>, что бы создать экземпляр, затем вызывает метод <code><em>init</em></code> для его инициализации и, наконец, возвращает экземпляр вызывающей программе</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Экземпляры классов</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если в классе определен метод <code><em>call</em></code>, то его экземпляры можно вызвать, как функции</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Генераторные функции</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Функции или методы, в которых используется ключевое слово <code>yield</code>. При вызове генераторная функция возвращает объект-генератор</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Учитывая разнообразие вызываемых типов в Python, самый безопасный способ узнать, является ли объект вызываемым, - воспользоваться встроенной функцией callable()
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_пользовательские_вызываемые_типы">Пользовательские вызываемые типы</h3>
<div class="listingblock">
<div class="title">Пример создания класса с реализованным методом <code>__call__</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">random</span>


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">BingoCage</span>:
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    Экземпляр этого класса строится из любого иттерируемого объекта и</span><span>
</span><span>    хранит внутри себя список элементов в случайном порядке. При вызове</span><span>
</span><span>    экземпляра из списка удаляется один элемент.</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__init__</span>(<span style="color:#069">self</span>, items=<span style="color:#069">None</span>):
        <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>        Метод __init__ принимает произвольный иттерируемый объект;</span><span>
</span><span>        Создание локальной копии предотвращает изменение списка, переданного</span><span>
</span><span>        в качестве аргумента.</span><span>
</span><span>        </span><span style="color:black">&quot;&quot;&quot;</span></span>
        <span style="color:#069">self</span>._items = <span style="color:#369;font-weight:bold">list</span>(items)
        random.shuffle(<span style="color:#069">self</span>._items)  <span style="color:#777"># Метод shuffle гарантированно работает, т.к. self._items объект тип list.</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">pick</span>(<span style="color:#069">self</span>):
        <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>        Основной метод.</span><span>
</span><span>        </span><span style="color:black">&quot;&quot;&quot;</span></span>
        <span style="color:#080;font-weight:bold">try</span>:
            <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>._items.pop()
        <span style="color:#080;font-weight:bold">except</span> <span style="color:#C00;font-weight:bold">IndexError</span>:
            <span style="color:#777"># Возбудить исключение со специальным сообщением, если список self._items пустой.</span>
            <span style="color:#080;font-weight:bold">raise</span> <span style="color:#C00;font-weight:bold">LookupError</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">pick from empty BingoCage</span><span style="color:#710">'</span></span>)

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__call__</span>(<span style="color:#069">self</span>):
        <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>        Позволяет писать просто bingo() вместо bingo.pick()</span><span>
</span><span>        :return:</span><span>
</span><span>        </span><span style="color:black">&quot;&quot;&quot;</span></span>
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>.pick()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Демонстрация BingoCage</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">&gt;&gt;&gt; from source.bingocall import BingoCage
&gt;&gt;&gt; bingo = BingoCage(range(3))
&gt;&gt;&gt; bingo.pick()
2
&gt;&gt;&gt; bingo()
1
&gt;&gt;&gt; callable(bingo)
True</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Объект <code>bingo</code> можно вызвать как функцию, и встроенная функция <code>callable(&#8230;&#8203;)</code> распознает его как вызываемый объект
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Пример классного разбора именованых и не именовых аргументов функции</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">tag</span>(name, *content, cls=<span style="color:#069">None</span>, **attrs):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    Функция tag генерирует HTML; чисто именованый аргумент cls</span><span>
</span><span>    для передачи аттрибута &quot;class&quot;. Это обходное решение необходимо,</span><span>
</span><span>    т.к. в Python class - Зарезервированное слово.</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    print(name)
    <span style="color:#080;font-weight:bold">if</span> cls <span style="color:#080;font-weight:bold">is</span> <span style="color:#080;font-weight:bold">not</span> <span style="color:#069">None</span>:
        attrs[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">class</span><span style="color:#710">'</span></span>] = cls
    <span style="color:#080;font-weight:bold">if</span> attrs:
        attr_str = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>.join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> %s=&quot;%s&quot;</span><span style="color:#710">'</span></span> % (attr, value) <span style="color:#080;font-weight:bold">for</span> attr, value <span style="color:#080;font-weight:bold">in</span> <span style="color:#369;font-weight:bold">sorted</span>(attrs.items()))
    <span style="color:#080;font-weight:bold">else</span>:
        attr_str = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">if</span> content:
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#b0b">\n</span><span style="color:#710">'</span></span>.join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%s%s&gt;%s&lt;/%s&gt;</span><span style="color:#710">'</span></span> % (name, attr_str, c, name) <span style="color:#080;font-weight:bold">for</span> c <span style="color:#080;font-weight:bold">in</span> content)
    <span style="color:#080;font-weight:bold">else</span>:
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;%s%s /&gt;</span><span style="color:#710">'</span></span> % (name, attr_str)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_получение_информации_о_параметрах">Получение информации о параметрах</h3>
<div class="ulist">
<ul>
<li>
<p>У объекта-функции есть аттрибут <code><em>defaults</em></code>, в котором хранится кортеж со значениями по умолчанию позиционных и именованных параметров.</p>
</li>
<li>
<p>Значения чисто именованных аргументов находятся в <code><em>kwdefaults</em></code></p>
</li>
<li>
<p>Сами имена параметров находятся в атрибуте <code><em>code</em></code>, который содержится ссылку на объект <code>code</code> с множеством своих собственных параметров</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">&gt;&gt;&gt; from source.tag import tag
&gt;&gt;&gt; tag.__code__.co_varnames
('name', 'cls', 'content', 'attrs')
&gt;&gt;&gt; tag.__code__.co_argcount
1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inspect_signature">inspect.signature</h3>
<div class="paragraph">
<p>Метод <code>inspect.signature</code> возвращает объект inspect.Signature, у которого есть аттрибут <code>parameters</code>, позволяющий прочитать упорядоченное отображение имен на объекы типа <code>inspect.Parameter</code>. У каждого объекта <code>Parameter</code> есть набор аттрибутов, например: <code>name</code>, <code>default</code> и <code>kind</code>. Специально значение <code>inspect._empty</code> обозначающий параметры, не имеющие значения по-умолчанию.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; <span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">inspect</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">signature</span>
&gt;&gt;&gt; sig = signature(help)
&gt;&gt;&gt; sig
&lt;Signature (*args, **kwds)&gt;
&gt;&gt;&gt; <span style="color:#369;font-weight:bold">str</span>(sig)
<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">(*args, **kwds)</span><span style="color:#710">'</span></span>
&gt;&gt;&gt; <span style="color:#080;font-weight:bold">for</span> name, param <span style="color:#080;font-weight:bold">in</span> sig.parameters.items(): print(param.kind, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">:</span><span style="color:#710">'</span></span>, name, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">=</span><span style="color:#710">'</span></span>, param.default)
...
VAR_POSITIONAL : args = &lt;<span style="color:#080;font-weight:bold">class</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">inspect._empty</span><span style="color:#710">'</span></span>&gt;
VAR_KEYWORD : kwds = &lt;<span style="color:#080;font-weight:bold">class</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">inspect._empty</span><span style="color:#710">'</span></span>&gt;
&gt;&gt;&gt; sig = signature(<span style="color:#369;font-weight:bold">open</span>)
&gt;&gt;&gt; <span style="color:#080;font-weight:bold">for</span> name, param <span style="color:#080;font-weight:bold">in</span> sig.parameters.items(): print(param.kind, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">:</span><span style="color:#710">'</span></span>, name, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">=</span><span style="color:#710">'</span></span>, param.default)
...
POSITIONAL_OR_KEYWORD : file = &lt;<span style="color:#080;font-weight:bold">class</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">inspect._empty</span><span style="color:#710">'</span></span>&gt;
POSITIONAL_OR_KEYWORD : mode = r
POSITIONAL_OR_KEYWORD : buffering = -<span style="color:#00D">1</span>
POSITIONAL_OR_KEYWORD : encoding = <span style="color:#069">None</span>
POSITIONAL_OR_KEYWORD : errors = <span style="color:#069">None</span>
POSITIONAL_OR_KEYWORD : newline = <span style="color:#069">None</span>
POSITIONAL_OR_KEYWORD : closefd = <span style="color:#069">True</span>
POSITIONAL_OR_KEYWORD : opener = <span style="color:#069">None</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>У объекта <code>inspect.Signature</code> имеется метод <code>bind</code>, который принимает любое количество атрибутов и связывает их с параметрами, указанных в сигнатуре, следуя обычным правилам сопоставления фактических аргументов с формальными параметрами.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Каркас может использовать эту возможность для проверки аттрибутов до фактического вызова функции.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Связывание сигнатуры функции <code>tag</code> со словарём аргументов</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">&gt;&gt;&gt; import inspect
&gt;&gt;&gt; from source.tag import tag
&gt;&gt;&gt; sig = inspect.signature(tag)
&gt;&gt;&gt; my_tag = {
... 'name'  : 'img',
... 'title' : 'Sunset Boulevard',
... 'src'   : 'sunset.jpg',
... 'cls'   : 'framed'
... }
&gt;&gt;&gt; bounds_args = sig.bind(**my_tag)
&gt;&gt;&gt; bounds_args
&lt;BoundArguments (name='img', cls='framed', attrs={'title': 'Sunset Boulevard', 'src': 'sunset.jpg'})&gt;
&gt;&gt;&gt; for name, value in bounds_args.arguments.items(): print(name, '=', value)
...
name = img
cls = framed
attrs = {'title': 'Sunset Boulevard', 'src': 'sunset.jpg'}
&gt;&gt;&gt; del my_tag['name']
&gt;&gt;&gt; bounds_args = sig.bind(**my_tag)
Traceback (most recent call last):
  File &quot;&lt;pyshell#16&gt;&quot;, line 1, in &lt;module&gt;
    bounds_args = sig.bind(**my_tag)
  File &quot;C:\Users\User\AppData\Local\Programs\Python\Python38-32\lib\inspect.py&quot;, line 3025, in bind
    return self._bind(args, kwargs)
  File &quot;C:\Users\User\AppData\Local\Programs\Python\Python38-32\lib\inspect.py&quot;, line 2940, in _bind
    raise TypeError(msg) from None
TypeError: missing a required argument: 'name'
&gt;&gt;&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
На этом примере видно, как модель данных Python - посредством модуля inspect - раскрывает механизм, которым пользуется сам интерпретатор дя связывания аргументов с формальными параметрами при вызове функии.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_аннотация_функций">Аннотация функций</h3>
<div class="listingblock">
<div class="title">Аннотированная функция clip</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">clip</span>(text: <span style="color:#369;font-weight:bold">str</span>, max_len: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">int &gt; 0</span><span style="color:#710">'</span></span> = <span style="color:#00D">80</span>) -&gt; <span style="color:#369;font-weight:bold">str</span>:  <span style="color:#777"># Аннотированное объявление функции</span>
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    Return text clipped at the last space before or after max_len</span><span>
</span><span>
</span><span>    :param text:</span><span>
</span><span>        Переменная с текстом</span><span>
</span><span>    :param max_len:</span><span>
</span><span>        Максимальная длина возвращаемой строки</span><span>
</span><span>    :return:</span><span>
</span><span>        Возращает строку обрезаную до последнего пробела или до максимальной длины.</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    end = <span style="color:#069">None</span>
    <span style="color:#080;font-weight:bold">if</span> <span style="color:#369;font-weight:bold">len</span>(text) &gt; max_len:
        space_before = text.rfind(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> </span><span style="color:#710">'</span></span>, <span style="color:#00D">0</span>, max_len)
        <span style="color:#080;font-weight:bold">if</span> space_before &gt;= <span style="color:#00D">0</span>:
            end = space_before
        <span style="color:#080;font-weight:bold">else</span>:
            space_after = text.rfind(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20"> </span><span style="color:#710">'</span></span>, max_len)
            <span style="color:#080;font-weight:bold">if</span> space_after &gt;= <span style="color:#00D">0</span>:
                end = space_after
    <span style="color:#080;font-weight:bold">if</span> end <span style="color:#080;font-weight:bold">is</span> <span style="color:#069">None</span>:  <span style="color:#777"># No spaces were found</span>
        end = <span style="color:#369;font-weight:bold">len</span>(text)
    <span style="color:#080;font-weight:bold">return</span> text[:end].rstrip()</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>У любого аргумента в объявлении функции может быть выражение аннотации, которому предшествует <code>:</code>.</p>
</li>
<li>
<p>Если у аргумента есть значение по-умолчанию, то аннотация располагается между именем и знаком <code>=</code>.</p>
</li>
<li>
<p>Что-бы аннотировать возвращаемое значение, поместите <code>&#8594;</code> и вслед за ним выражение между знаком <code>)</code> и двоеточием в конце объявления функции.</p>
</li>
<li>
<p>Аннотации никак не обрабатываются. Они просто сохраняются в аттрибуте функции <code>__annotations__</code> тип <code>dict</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">&gt;&gt;&gt; from source.clip_annot import clip
&gt;&gt;&gt; clip.__annotations__
{'text': &lt;class 'str'&gt;, 'max_len': 'int &gt; 0', 'return': &lt;class 'str'&gt;}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_пакеты_для_функционального_программирования">Пакеты для функционального программирования</h3>
<div class="sect3">
<h4 id="_модуль_operator">Модуль <code>operator</code></h4>
<div class="paragraph">
<p>Модуль <code>operator</code> включает в себя функции для выборки элементов из последовательностей и чтения атрибутов объектов: <code>itemgetter</code> и <code>attrgetter</code> строят специализированные функции для выполнения этих действий.</p>
</div>
<div class="listingblock">
<div class="title">Результат применения <code>itemgetter</code> для сортировки списка кортежей</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">operator</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">itemgetter</span>

metro_data = [
    (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Tokyo</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">JP</span><span style="color:#710">'</span></span>, <span style="color:#60E">36.933</span>, (<span style="color:#00D">35</span>, <span style="color:#00D">139</span>)),
    (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Delhi NCR</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">IN</span><span style="color:#710">'</span></span>, <span style="color:#60E">21.935</span>, (<span style="color:#00D">28</span>, <span style="color:#00D">77</span>)),
    (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Mexico City</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">MX</span><span style="color:#710">'</span></span>, <span style="color:#60E">20.142</span>, (<span style="color:#00D">19</span>, -<span style="color:#00D">99</span>)),
    (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">New York-Newark</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">US</span><span style="color:#710">'</span></span>, <span style="color:#60E">20.104</span>, (<span style="color:#00D">40</span>, -<span style="color:#00D">74</span>)),
    (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Sao Paulo</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">BR</span><span style="color:#710">'</span></span>, <span style="color:#60E">19.649</span>, (-<span style="color:#00D">23</span>, -<span style="color:#00D">46</span>)),
]

<span style="color:#080;font-weight:bold">for</span> city <span style="color:#080;font-weight:bold">in</span> <span style="color:#369;font-weight:bold">sorted</span>(metro_data, key=itemgetter(<span style="color:#00D">1</span>)):
    print(city)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell script">py .\metro_data.py
('Sao Paulo', 'BR', 19.649, (-23, -46))
('Delhi NCR', 'IN', 21.935, (28, 77))
('Tokyo', 'JP', 36.933, (35, 139))
('Mexico City', 'MX', 20.142, (19, -99))
('New York-Newark', 'US', 20.104, (40, -74))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_фиксация_аргументов_с_помощью_functools_partial">Фиксация аргументов с помощью <code>functools.partial</code></h3>
<div class="paragraph">
<p>В модуле <code>functools</code> собраны некоторые функции высшего порядка. Из них наиболее широко известна функция <code>reduce</code>. Помимо неё, особенно полезна функция <code>partial</code> и её вариация <code>partialmethod</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>functools.partial</code>&#8201;&#8212;&#8201;функция высшего порядка. Позволяет применять функцию "частично". Получив на вход некоторую функцию, <code>partial</code> создает новый вызываемый объект, в котором некоторые аргументы исходной функции фиксированы. Функция <code>partial</code> принимает в первом аргументе вызываемый объект, а за ним - произвольное число позиционных и именованных аргументов, подлежащих связыванию.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Построение вспомогательной функции нормализации Unicode-строк с помощью partial</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">&gt;&gt;&gt; import functools
&gt;&gt;&gt; import unicodedata
&gt;&gt;&gt; nfc = functools.partial(unicodedata.normalize, 'NFC')
&gt;&gt;&gt; s1 = 'café'
&gt;&gt;&gt; s2 = 'cafe\u0301'
&gt;&gt;&gt; nfc(s1) == nfc(s2)
True
&gt;&gt;&gt; s1 == s2
False</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>functools.partialmethod</code>&#8201;&#8212;&#8201;делает тоже самое, что и <code>partial</code>, но предназначена для работы с методами.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_спецификации_и_статьи_по_пройденному_материалу">Спецификации и статьи по пройденному материалу:</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://www.python.org/dev/peps/pep-3102/">PEP 3102&#8201;&#8212;&#8201;Keyword-Only Arguments</a></p>
</li>
<li>
<p><a href="https://www.python.org/dev/peps/pep-3107/">PEP 3107&#8201;&#8212;&#8201;Function Annotations</a></p>
</li>
<li>
<p><a href="https://www.python.org/dev/peps/pep-0362/">PEP 362&#8201;&#8212;&#8201;Function Signature Object</a></p>
</li>
<li>
<p><a href="https://docs.python.org/3/howto/functional.html">Functional Programming HOWTO</a></p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_глава_6_реализация_паттернов_проектирования_с_помощью_полноправных_функций">Глава 6. <em>Реализация паттернов проектирования с помощью полноправных функций.</em></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_практический_пример_переработка_паттерна_стратегия">Практический пример: переработка паттерна Стратегия.</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">В книге "Паттерны проектирования" паттерн <strong>Стратегия</strong> описывается следующим образом:</div>
Определить семейство алгоритмов, инкапсулировать каждый из них и сделать их взаимозаменяемыми. Стратегия позволяет заменять алгоритмы независимо от использующих его клиентов.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Наглядный пример применения паттерна Стратегия к коммерческой задаче&#8201;&#8212;&#8201;вычисление скидок на заказы в соответствии с характеристиками заказчика или результатами анализа заказанных позиций.
Рассмотрим интернет-магазин со следующими правилами формирования скидок:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Заказчику, имеющему не менее 1000 баллов лояльности, предоставляется глобальная скидка <code>5%</code> на весь заказ;</p>
</li>
<li>
<p>На позиции, заказанные в количестве не менее 20 штук, предоставляется скидка <code>10%</code></p>
</li>
<li>
<p>На заказы, содержащие не мене 10 различных позиций, предоставляется глобальная скидка <code>7%</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Для простоты предложим, что к каждому заказчику может быть применена только одна скидка.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="diag-3b5b248a346496592c094c5817c4cb04.png" alt="Diagram" width="610" height="434">
</div>
<div class="title">Figure 1. UML-диаграмма классов для обработки заказов</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Контекст</div>
Представляет службу, делегируя часть вычислений взаимозаменяемым компонентам, реализующих различные алгоритмы. В примере Интернет-магазина контекстом является класс <code>Order</code>, который конфигурируется для применения поощрительной скидки по одному из нескольких алгоритмов.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Стратегия</div>
Интерфейс, общий для всех компонентов, реализующих различные алгоритмы. В нашем примере эту роль играет абстрактный класс <code>Promotion</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Конкретные стратегии</div>
Один из конкретных подклассов Стратегии. В нашем примере реализованы три конкретные стратегии: <code>FidelityPromo</code>, <code>BulkItemPromo</code>, <code>LargeOrderPromo</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>В нашем примере система, перед тем как создать объект заказ, должна каким-то образом определит стратегию предоставления скидки и передать ее конструктору класса <code>Order</code>.
Вопрос о выборе стратегии не является предметом данного паттерна.</p>
</div>
<div class="listingblock">
<div class="title">Реализация класса <code>Order</code> с помощью взаимозаменяемых стратегий</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">abc</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">ABC</span>, <span style="color:#B44;font-weight:bold">abstractmethod</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">collections</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">namedtuple</span>

Customer = namedtuple(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Customer</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name fidelity</span><span style="color:#710">'</span></span>)


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">LineItem</span>:

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__init__</span>(<span style="color:#069">self</span>, product, quantity, price):
        <span style="color:#069">self</span>.product = product
        <span style="color:#069">self</span>.quantity = quantity
        <span style="color:#069">self</span>.price = price

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">total</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>.price * <span style="color:#069">self</span>.quantity


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Order</span>:
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    Контекст</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__init__</span>(<span style="color:#069">self</span>, customer, cart, promotion=<span style="color:#069">None</span>):
        <span style="color:#069">self</span>.customer = customer
        <span style="color:#069">self</span>.cart = <span style="color:#369;font-weight:bold">list</span>(cart)
        <span style="color:#069">self</span>.promotion = promotion

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">total</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">if</span> <span style="color:#080;font-weight:bold">not</span> <span style="color:#369;font-weight:bold">hasattr</span>(<span style="color:#069">self</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">__total</span><span style="color:#710">'</span></span>):
            <span style="color:#069">self</span>.__total = <span style="color:#369;font-weight:bold">sum</span>(item.total() <span style="color:#080;font-weight:bold">for</span> item <span style="color:#080;font-weight:bold">in</span> <span style="color:#069">self</span>.cart)
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>.__total

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">due</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">if</span> <span style="color:#069">self</span>.promotion <span style="color:#080;font-weight:bold">is</span> <span style="color:#069">None</span>:
            discount = <span style="color:#00D">0</span>
        <span style="color:#080;font-weight:bold">else</span>:
            discount = <span style="color:#069">self</span>.promotion.discount(<span style="color:#069">self</span>)
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>.total() - discount

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__repr__</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">return</span> f<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;Order total: {self.total():.2f} due: {self.due():.2f}&gt;</span><span style="color:#710">'</span></span>


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Promotion</span>(ABC):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    Стратегия: абстрактный базовый класс</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#B0B">@abstractmethod</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">discount</span>(<span style="color:#069">self</span>, order):
        <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>        Вернуть скидку в виде положительной суммы в долларах</span><span>
</span><span>        :param order:</span><span>
</span><span>        :return:</span><span>
</span><span>        </span><span style="color:black">&quot;&quot;&quot;</span></span>


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">FidelityPromo</span>(Promotion):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    5%-я скидка для заказчиков, имеющих не менее 1000 баллов лояльности</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">discount</span>(<span style="color:#069">self</span>, order):
        <span style="color:#080;font-weight:bold">return</span> order.total() * <span style="color:#60E">.05</span> <span style="color:#080;font-weight:bold">if</span> order.customer.fidelity &gt;= <span style="color:#00D">1000</span> <span style="color:#080;font-weight:bold">else</span> <span style="color:#00D">0</span>


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">BulkItemPromo</span>(Promotion):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    10%-я скидка для каждой позиции LineItem, в которой заказано не мене 20 единиц</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">discount</span>(<span style="color:#069">self</span>, order):
        discount = <span style="color:#00D">0</span>
        <span style="color:#080;font-weight:bold">for</span> item <span style="color:#080;font-weight:bold">in</span> order.cart:
            <span style="color:#080;font-weight:bold">if</span> item.quantity &gt;= <span style="color:#00D">20</span>:
                discount += item.total() * <span style="color:#60E">.1</span>
        <span style="color:#080;font-weight:bold">return</span> discount


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">LargeOrderPromo</span>(Promotion):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    7%-я скидка для заказов, включающих не менее 10 различных позици</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">discount</span>(<span style="color:#069">self</span>, order):
        distinct_items = {item.product <span style="color:#080;font-weight:bold">for</span> item <span style="color:#080;font-weight:bold">in</span> order.cart}
        <span style="color:#080;font-weight:bold">if</span> <span style="color:#369;font-weight:bold">len</span>(distinct_items) &gt;= <span style="color:#00D">10</span>:
            <span style="color:#080;font-weight:bold">return</span> order.total() * <span style="color:#60E">.07</span>
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Пример работает без нареканий, но ту же функциональность можно реализовать в Python гораздо короче, воспользовавшись функциями как объектами.</p>
</div>
</div>
<div class="sect2">
<h3 id="_функционально_ориентированная_стратегия">Функционально-ориентированная стратегия.</h3>
<div class="paragraph">
<p>Каждая конкретная стратегия в примере&#8201;&#8212;&#8201;это класс с одним методом <code>discount</code>. Сильно напоминают функции.
В следующем примере код переработан&#8201;&#8212;&#8201;конкретные классы заменены функциями, а абстрактный класс <code>Promo</code> исключен</p>
</div>
<div class="listingblock">
<div class="title">Класс <code>Order</code>, в котором реализован в виде функций</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">collections</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">namedtuple</span>

Customer = namedtuple(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Customer</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name fidelity</span><span style="color:#710">'</span></span>)


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">LineItem</span>:

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__init__</span>(<span style="color:#069">self</span>, product, quantity, price):
        <span style="color:#069">self</span>.product = product                      <span style="color:#777"># Наименование</span>
        <span style="color:#069">self</span>.quantity = quantity                    <span style="color:#777"># Количество</span>
        <span style="color:#069">self</span>.price = price                          <span style="color:#777"># Цена</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">total</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>.price * <span style="color:#069">self</span>.quantity           <span style="color:#777"># Общая стоимость позиции</span>


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Order</span>:                                        <span style="color:#777"># Контекст</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__init__</span>(<span style="color:#069">self</span>, customer, cart, promotion=<span style="color:#069">None</span>):
        <span style="color:#069">self</span>.customer = customer
        <span style="color:#069">self</span>.cart = cart
        <span style="color:#069">self</span>.promotion = promotion

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">total</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">if</span> <span style="color:#080;font-weight:bold">not</span> <span style="color:#369;font-weight:bold">hasattr</span>(<span style="color:#069">self</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">__total</span><span style="color:#710">'</span></span>):
            <span style="color:#069">self</span>.__total = <span style="color:#369;font-weight:bold">sum</span>(item.total() <span style="color:#080;font-weight:bold">for</span> item <span style="color:#080;font-weight:bold">in</span> <span style="color:#069">self</span>.cart)
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>.__total

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">due</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">if</span> <span style="color:#069">self</span>.promotion <span style="color:#080;font-weight:bold">is</span> <span style="color:#069">None</span>:
            discount = <span style="color:#00D">0</span>
        <span style="color:#080;font-weight:bold">else</span>:
            discount = <span style="color:#069">self</span>.promotion.discount(<span style="color:#069">self</span>)
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>.total() - discount

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__repr__</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">return</span> f<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;Order total: {self.total():.2f} due: {self.due():.2f}&gt;</span><span style="color:#710">'</span></span>


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">fidelity_promo</span>(order):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    5%-я скидка для заказчиков, имеющих не менее 1000 баллов лояльности</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#080;font-weight:bold">return</span> order.total() * <span style="color:#60E">.05</span> <span style="color:#080;font-weight:bold">if</span> order.customer.fidelity &gt;= <span style="color:#00D">1000</span> <span style="color:#080;font-weight:bold">else</span> <span style="color:#00D">0</span>


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">bulk_item_promo</span>(order):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    10%-я скидка для каждой позиции LineItem, в которой заказано не мене 20 единиц</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    discount = <span style="color:#00D">0</span>
    <span style="color:#080;font-weight:bold">for</span> item <span style="color:#080;font-weight:bold">in</span> order.cart:
        <span style="color:#080;font-weight:bold">if</span> item.quantity &gt;= <span style="color:#00D">20</span>:
            discount += item.total() * <span style="color:#60E">.1</span>
    <span style="color:#080;font-weight:bold">return</span> discount


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">large_order_promo</span>(order):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    7%-я скидка для заказов, включающих не менее 10 различных позици</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    distinct_items = {item.product <span style="color:#080;font-weight:bold">for</span> item <span style="color:#080;font-weight:bold">in</span> order.cart}
    <span style="color:#080;font-weight:bold">if</span> <span style="color:#369;font-weight:bold">len</span>(distinct_items) &gt;= <span style="color:#00D">10</span>:
        <span style="color:#080;font-weight:bold">return</span> order.total() * <span style="color:#60E">.07</span>
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">0</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_выбор_наилучшей_стратегии_простой_подход">Выбор наилучшей стратегии: простой подход</h3>
<div class="listingblock">
<div class="title">Реализация функции выбора наилучшая стратегии</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">source.strategy_3</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">fidelity_promo</span>, <span style="color:#B44;font-weight:bold">bulk_item_promo</span>, <span style="color:#B44;font-weight:bold">large_order_promo</span>
promos = [fidelity_promo, bulk_item_promo, large_order_promo]
<span style="color:#777"># promos - список стратегий реализованный в виде функций</span>


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">best_promo</span>(order):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    :param order: список покупок</span><span>
</span><span>    :return: максимально возможную скидку из params</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#369;font-weight:bold">max</span>(promo(order) <span style="color:#080;font-weight:bold">for</span> promo <span style="color:#080;font-weight:bold">in</span> promos)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Фишка в том что бы воспринимать функцию как объект, который можно передавать в виде параметра.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
В данном коде возможна тонка ошибка. При написании новой стратегии, возможно забыть добавить её в список <code>promos</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_поиск_стратегии_в_модуле">Поиск стратегии в модуле</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>globals()</code> - возвращает словарь, представляющий текущую таблицу глобальных символов. Это всегда словарь текущего модуля.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Список promos строится путем перебора глобального пространства имен</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">promos = [<span style="color:#369;font-weight:bold">globals</span>()[name] <span style="color:#080;font-weight:bold">for</span> name <span style="color:#080;font-weight:bold">in</span> <span style="color:#369;font-weight:bold">globals</span>() <span style="color:#080;font-weight:bold">if</span> name.endswith(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">_promo</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">and</span> name != <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">best_promo</span><span style="color:#710">'</span></span>]
<span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>promos - перебираем все имена в словаре, </span><span>
</span><span>возвращенном функцией global(), оставляем </span><span>
</span><span>только те что с суффикосом _promo и не best_promo</span><span>
</span><span style="color:black">&quot;&quot;&quot;</span></span>


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">best_promo</span>(order):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    :param order: список покупок</span><span>
</span><span>    :return: максимально возможную скидку из params</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#369;font-weight:bold">max</span>(promo(order) <span style="color:#080;font-weight:bold">for</span> promo <span style="color:#080;font-weight:bold">in</span> promos)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_паттерн_команда">Паттерн Команда</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Цель <strong>Команды</strong> - разорвать связь между объектом, инициировавшим операцию (Инициатором) и объектом, который её реализует (Получатель).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>В примере Инициаторы - это пункты меню в графическом редакторе, а Получателем - редактируемый документ или само приложении.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="diag-3a33c2bd9321fae762204f479690f0e5.png" alt="Diagram" width="840" height="462">
</div>
<div class="title">Figure 2. UML-диаграмма классов для управляемого меню текстового редактора, реализованного с помощью паттерна Команда. У каждой команды может быть свой получатель: объект, выполняющий действие. Для команды <code>PasteCommand</code> получателем является <code>Document</code>, а для <code>OpenCommand</code>- приложение.</div>
</div>
<div class="paragraph">
<p>Идея в том, что бы между инициатором и исполнителем поместить объект <code>Command</code>, который реализует интерфейс с одним
методом <code>execute()</code>, вызывающим какой-то метод Получателя для выполнения желаемой операции. Таким образом, Инициатор
ничего не знает об интерфейсе Получателя, так что, написав подкласс <code>Command</code>, можно адаптировать различные получатели.
Инициатор конфигурируется конкретной командой и вызывает ее метод <code>execute</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Класс <code>MacroCommand</code>, который может содержать последовательность команд; его метод <code>execute()</code> вызывает одноименные методы каждой хранимой команды.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Вместо передачи объекта <code>Command</code>, мы можем передать обычную функцию. Реализовать можно через специальный метод <code>__call__</code>.</p>
</div>
<div class="paragraph">
<p>Тогда <code>MacroCommand</code> будут вызываемыми объектами, содержащими список функций для последующего вызова.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MacroCommand</span>:
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    Команда, выполняющая список команд</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__init__</span>(<span style="color:#069">self</span>, commands):
        <span style="color:#069">self</span>.commands = <span style="color:#369;font-weight:bold">list</span>(commands)

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__call__</span>(<span style="color:#069">self</span>, *args, **kwargs):
        <span style="color:#080;font-weight:bold">for</span> command <span style="color:#080;font-weight:bold">in</span> <span style="color:#069">self</span>.commands:
            command()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ссылочки_и_дополнительные_материалы">Ссылочки и дополнительные материалы</h3>
<div class="ulist">
<ul>
<li>
<p><a href="http://bit.ly/1HGC0r5">Паттерны поректирования в динамических языках.</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#777">#!./venv/Scripts/python.exe</span>
<span style="color:#777"># -*- coding: utf-8 -*-</span>
<span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>Паттерн СТРАТЕГИЯ определяет семейство алгоритмов, инкапсулирует</span><span>
</span><span>каждый из них и обеспечивает их взаимозаменяемость. Он позволяет</span><span>
</span><span>модифицировать алгоритмы независимо от их использования на сторо-</span><span>
</span><span>не клиента.</span><span>
</span><span style="color:black">&quot;&quot;&quot;</span></span>
COLLEAGUES = (<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Павел Клименко</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Павел Румянцев</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Николай Ластовский</span><span style="color:#710">'</span></span>,
              <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Кирилл Кулешов</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Сергей Мирук</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Алёна Ларина</span><span style="color:#710">'</span></span>)


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Layout</span>:
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    Этот класс поддерживает только один алгоритм: табуляция. Функция,</span><span>
</span><span>    реализующая этот алгоритм, ожидает получить счетчик строк и после-</span><span>
</span><span>    довательность элементов, а возвращает результат в виде таблицы.</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__init__</span>(<span style="color:#069">self</span>, tabulator):
        <span style="color:#069">self</span>.tabulate = tabulator

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">tabulate</span>(<span style="color:#069">self</span>, rows, items):
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>.tabulator(rows, items)


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">main</span>():
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    В этой функции создаются 2 объекта Layout, параметризованные</span><span>
</span><span>    различными функциями-табуляторами. Для каждого формата печатается</span><span>
</span><span>    таблица с 2,3,4,5 строками</span><span>
</span><span>    :return:</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    htmlLayout = Layout(html_tabulator)
    <span style="color:#080;font-weight:bold">for</span> rows <span style="color:#080;font-weight:bold">in</span> <span style="color:#369;font-weight:bold">range</span>(<span style="color:#00D">2</span>, <span style="color:#00D">6</span>):
        print(htmlLayout.tabulate(rows, COLLEAGUES))
    textLayout = Layout(text_tabulator)
    <span style="color:#080;font-weight:bold">for</span> rows <span style="color:#080;font-weight:bold">in</span> <span style="color:#369;font-weight:bold">range</span>(<span style="color:#00D">2</span>, <span style="color:#00D">6</span>):
        print(textLayout.tabulate(rows, COLLEAGUES))</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_глава_7_декораторы_и_функции_замыкания">Глава 7. <em>Декораторы и функции замыкания</em></h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Декоратор - это вызываемый объект, принимающий в качестве аргумента другую функцию.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_главное_что_нужно_знать_о_декораторах">Главное, что нужно знать о декораторах:</h3>
<div class="ulist">
<ul>
<li>
<p>Тот факт, что они властны заменить декорируемую функцию другой;</p>
</li>
<li>
<p>Выполняется сразу после загрузки модуля;</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_паттерн_стратегия_дополненный_декоратором">Паттерн Стратегия, дополненный декоратором</h3>
<div class="listingblock">
<div class="title">Список <code>promos</code> заполняется декоратором <code>promotion</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">collections</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">namedtuple</span>

Customer = namedtuple(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Customer</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name fidelity</span><span style="color:#710">'</span></span>)


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">LineItem</span>:

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__init__</span>(<span style="color:#069">self</span>, product, quantity, price):
        <span style="color:#069">self</span>.product = product                      <span style="color:#777"># Наименование</span>
        <span style="color:#069">self</span>.quantity = quantity                    <span style="color:#777"># Количество</span>
        <span style="color:#069">self</span>.price = price                          <span style="color:#777"># Цена</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">total</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>.price * <span style="color:#069">self</span>.quantity           <span style="color:#777"># Общая стоимость позиции</span>


<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Order</span>:                                        <span style="color:#777"># Контекст</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__init__</span>(<span style="color:#069">self</span>, customer, cart, promotion=<span style="color:#069">None</span>):
        <span style="color:#069">self</span>.customer = customer
        <span style="color:#069">self</span>.cart = cart
        <span style="color:#069">self</span>.promotion = promotion

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">total</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">if</span> <span style="color:#080;font-weight:bold">not</span> <span style="color:#369;font-weight:bold">hasattr</span>(<span style="color:#069">self</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">__total</span><span style="color:#710">'</span></span>):
            <span style="color:#069">self</span>.__total = <span style="color:#369;font-weight:bold">sum</span>(item.total() <span style="color:#080;font-weight:bold">for</span> item <span style="color:#080;font-weight:bold">in</span> <span style="color:#069">self</span>.cart)
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>.__total

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">due</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">if</span> <span style="color:#069">self</span>.promotion <span style="color:#080;font-weight:bold">is</span> <span style="color:#069">None</span>:
            discount = <span style="color:#00D">0</span>
        <span style="color:#080;font-weight:bold">else</span>:
            discount = <span style="color:#069">self</span>.promotion.discount(<span style="color:#069">self</span>)
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#069">self</span>.total() - discount

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__repr__</span>(<span style="color:#069">self</span>):
        <span style="color:#080;font-weight:bold">return</span> f<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;Order total: {self.total():.2f} due: {self.due():.2f}&gt;</span><span style="color:#710">'</span></span>


promos = []


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">promotion</span>(promo_func):
    promos.append(promo_func)
    <span style="color:#080;font-weight:bold">return</span> promo_func


<span style="color:#B0B">@promotion</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">fidelity</span>(order):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    5%-я скидка для заказчиков, имеющих не менее 1000 баллов лояльности</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#080;font-weight:bold">return</span> order.total() * <span style="color:#60E">.05</span> <span style="color:#080;font-weight:bold">if</span> order.customer.fidelity &gt;= <span style="color:#00D">1000</span> <span style="color:#080;font-weight:bold">else</span> <span style="color:#00D">0</span>


<span style="color:#B0B">@promotion</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">bulk_item</span>(order):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    10%-я скидка для каждой позиции LineItem, в которой заказано не мене 20 единиц</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    discount = <span style="color:#00D">0</span>
    <span style="color:#080;font-weight:bold">for</span> item <span style="color:#080;font-weight:bold">in</span> order.cart:
        <span style="color:#080;font-weight:bold">if</span> item.quantity &gt;= <span style="color:#00D">20</span>:
            discount += item.total() * <span style="color:#60E">.1</span>
    <span style="color:#080;font-weight:bold">return</span> discount


<span style="color:#B0B">@promotion</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">large_order</span>(order):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    7%-я скидка для заказов, включающих не менее 10 различных позици</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    distinct_items = {item.product <span style="color:#080;font-weight:bold">for</span> item <span style="color:#080;font-weight:bold">in</span> order.cart}
    <span style="color:#080;font-weight:bold">if</span> <span style="color:#369;font-weight:bold">len</span>(distinct_items) &gt;= <span style="color:#00D">10</span>:
        <span style="color:#080;font-weight:bold">return</span> order.total() * <span style="color:#60E">.07</span>
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">0</span>


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">best_promo</span>(order):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    Выбрать максимально возможную скидку</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#369;font-weight:bold">max</span>(promo(order) <span style="color:#080;font-weight:bold">for</span> promo <span style="color:#080;font-weight:bold">in</span> promos)</code></pre>
</div>
</div>
<div class="paragraph">
<p>По сравнению с другими решениями, у этого есть несколько преимуществ:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Функции, реализующие стратегии вычисления скидки могут избавиться от суффикса <code>_promo</code></p>
</li>
<li>
<p>Декоратор <code>@promotion</code> явно описывает назначение декорируемой функции и без труда позволяет временно отменить предоставление ссылки: достаточно закомментировать декоратор</p>
</li>
<li>
<p>Стратегии скидки можно определить в других модулях.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_правила_видимости_переменных">Правила видимости переменных</h3>
<div class="paragraph">
<p>Видимость локальных переменных определяется при компилировании байт-кода и если одноименная переменная определена в теле функции, то она будет считаться локальной.</p>
</div>
</div>
<div class="sect2">
<h3 id="_замыкания">Замыкания</h3>
<div class="paragraph">
<p>Замыкание вступает в игру только при наличии вложенной функции.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Замыкание&#8201;&#8212;&#8201;это функция с расширенной областью видимости, которая охватывает все не глобальные переменные, имеющие ссылки в теле функции, хотя они в нем не определены.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Эту идею довольно трудно переварить, поэтому пример.</p>
</div>
<div class="paragraph">
<p>Рассмотрим функцию <code>avg</code>, которая вычисляет среднее продолжающегося ряда чисел, например, среднюю цену закрытия биржевого товара за всю историю торгов. Каждый день ряд пополняется новой ценой, а при вычислении среднего учитываются все прежние цены.</p>
</div>
<div class="listingblock">
<div class="title">Если начать с чистого листа, то функция <code>avg</code> можно было бы использовать следующим образом:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">&gt;&gt;&gt; avg(10)
10.0
&gt;&gt;&gt; avg(11)
10.5
&gt;&gt;&gt; avg(12)
11.0</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Вопрос на подумать</div>
Откуда берется <code>avg</code> и где она хранит предыдущие значения?
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_реализация_average_основанная_на_классах">Реализация Average основанная на классах.</h4>
<div class="listingblock">
<div class="title">average_oo.py: класс для вычисления накопительного среднего значения</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Averager</span>:

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__init__</span>(<span style="color:#069">self</span>):
        <span style="color:#069">self</span>.series = []

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__call__</span>(<span style="color:#069">self</span>, new_value):
        <span style="color:#069">self</span>.series.append(new_value)
        total = <span style="color:#369;font-weight:bold">sum</span>(<span style="color:#069">self</span>.series)
        <span style="color:#080;font-weight:bold">return</span> total/<span style="color:#369;font-weight:bold">len</span>(<span style="color:#069">self</span>.series)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Класс <code>Averager</code> создает вызываемые объекты</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">&gt;&gt;&gt; from source.average_oo import Averager
&gt;&gt;&gt; avg = Averager()
&gt;&gt;&gt; avg(10)
10.0
&gt;&gt;&gt; avg(11)
10.5
&gt;&gt;&gt; avg(12)
11.0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Результат тестирования</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">&gt;&gt;&gt; import doctest
&gt;&gt;&gt; doctest.testfile('./source/doctest/avg_oo.txt')
TestResults(failed=0, attempted=5)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_функциональная_реализация_с_использованием_функции_высшего_порядка_make_averager">Функциональная реализация с использованием функции высшего порядка <code>make_averager</code></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">make_averager</span>():
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>    При обращении к make_averager возвращается объект-функция averager.</span><span>
</span><span>    При каждом вызове averager добавляет переданный аргумент в конец</span><span>
</span><span>    списка series и вычисляет текущее среднее.</span><span>
</span><span>    :return:</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    series = []

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">averager</span>(new_value):
        series.append(new_value)
        total = <span style="color:#369;font-weight:bold">sum</span>(series)
        <span style="color:#080;font-weight:bold">return</span> total/<span style="color:#369;font-weight:bold">len</span>(series)

    <span style="color:#080;font-weight:bold">return</span> averager</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Обратите внимание на сходство обоих примеров: мы обращаемся к <code>Averager</code> и к <code>make_averager</code> что бы получить вызываемый объект <code>avg</code>, который обновляет временной ряд и вычисляет среднее значение.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Совершенно ясно, где хранит историю объектов <code>avg</code> класса <code>Averager</code>: в аттрибуте экземпляра <code>self.series</code>. Но где находится <code>series</code> функции <code>avg</code> из второго примера?</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Внутри <code>averager</code> переменная <code>series</code> является <em>свободной</em>. Этот технический термин обозначает, что переменная не связана в локальной области видимости.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<strong>Python</strong> хранит имена локальных и свободных переменных в аттрибуте <code>__code__</code>, который представляет собой откомпилированное тело функции.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Инспекция функции, созданной функцией <code>make_averager</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">&gt;&gt;&gt; from source.average import make_averager
&gt;&gt;&gt; avg = make_averager()
&gt;&gt;&gt; avg.__code__.co_varnames
('new_value', 'total')
&gt;&gt;&gt; avg.__code__.co_freevars
('series',)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Привязка переменной <code>series</code> хранится в аттрибуте <code>__closure__</code> возвращенной функцией <code>avg</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Каждому элементу <code>avg.__closure__</code> соответствует имя в <code>avg.__code__.co_freevars</code>. Эти элементы называются <em>ячейками(cells)</em>, и у каждого из них есть атрибут <code>cell_contents</code>, где можно найти само значение.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Инспекция функции, созданной функцией <code>make_averager</code> (продолжение)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">&gt;&gt;&gt; avg.__closure__
(&lt;cell at 0x040DC358: list object at 0x039FA368&gt;,)
&gt;&gt;&gt; avg.__closure__[0].cell_contents
[10, 11, 12]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Резюмируем:</div>
<strong>Замыкание</strong>&#8201;&#8212;&#8201;это функция, которая запоминает привязку свободных переменных, существовавшие на момент определения функции. Так что их можно использовать впоследствии при вызове функции, когда область видимости, в которой она была определена уже не существует.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Единственная ситуация, когда функции может понадобиться доступ к внешней не глобальной переменной,- это когда она вложена в другую функцию.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_объявление_nonlocal">Объявление <code>nonlocal</code></h4>
<div class="paragraph">
<p>Приведенная ранее реализация <code>make_averager</code> не эффективна. Мы храним в переменной все значения и каждый раз вычисляем их сумму при каждом вызове <code>averager</code>. Лучше было бы хранить предыдущую сумму и количество элементов, тогда зная два числа мы можем вычислить среднее.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">В Pyton 3 было добавлено nonlocal</div>
<strong>nonlocal</strong> позволяет пометить переменную как свободную, даже если ей присваивается значение внутри функции. В таком случае изменяется привязка, хранящаяся в замыкании.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Правильная реализация идеи</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">make_averager</span>():
    count = <span style="color:#00D">0</span>
    total = <span style="color:#00D">0</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">averager</span>(new_value):
        <span style="color:#080;font-weight:bold">nonlocal</span> total, count
        count += <span style="color:#00D">1</span>
        total += new_value
        <span style="color:#080;font-weight:bold">return</span> total/count

    <span style="color:#080;font-weight:bold">return</span> averager</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_реализация_простого_декоратора">Реализация простого декоратора</h3>
<div class="listingblock">
<div class="title">Простой декоратор для вывода времени выполнения функции</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">functools</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">time</span>


<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">clock</span>(func):
    <span style="color:#D42"><span style="color:black">&quot;&quot;&quot;</span><span>
</span><span>        Декоратор functools.wraps копирует аргументы</span><span>
</span><span>        декорируемой функции.</span><span>
</span><span>    </span><span style="color:black">&quot;&quot;&quot;</span></span>
    <span style="color:#B0B">@functools.wraps</span>(func)
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">clocked</span>(*args, **kwargs):
        t0 = time.perf_counter()
        result = func(*args, **kwargs)
        elapsed = time.perf_counter() - t0
        name = func.__name__
        arg_list = []
        <span style="color:#080;font-weight:bold">if</span> args:
            arg_list.append(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">, </span><span style="color:#710">'</span></span>.join(<span style="color:#369;font-weight:bold">repr</span>(arg) <span style="color:#080;font-weight:bold">for</span> arg <span style="color:#080;font-weight:bold">in</span> args))
        <span style="color:#080;font-weight:bold">if</span> kwargs:
            pairs = [f<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">{k}={w}</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">for</span> k, w <span style="color:#080;font-weight:bold">in</span> <span style="color:#369;font-weight:bold">sorted</span>(kwargs.items())]
            arg_list.append(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">, </span><span style="color:#710">'</span></span>.join(pairs))
        arg_string = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">, </span><span style="color:#710">'</span></span>.join(arg_list)
        print(f<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">[{elapsed:0.8f}] {name}({arg_string} -&gt; {result})</span><span style="color:#710">'</span></span>)     <span style="color:#777"># [0.00000120] factorial(1 -&gt; 1)</span>
        <span style="color:#080;font-weight:bold">return</span> result
    <span style="color:#080;font-weight:bold">return</span> clocked</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Использование декоратора clock</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#777"># clock_decorator_demo.py</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">time</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">clock_decorator</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">clock</span>


<span style="color:#B0B">@clock</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">snooze</span>(seconds):
    time.sleep(seconds)


<span style="color:#B0B">@clock</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">factorial</span>(n):
    <span style="color:#080;font-weight:bold">return</span> <span style="color:#00D">1</span> <span style="color:#080;font-weight:bold">if</span> n &lt; <span style="color:#00D">2</span> <span style="color:#080;font-weight:bold">else</span> n*factorial(n-<span style="color:#00D">1</span>)


<span style="color:#080;font-weight:bold">if</span> __name__ == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">__main__</span><span style="color:#710">'</span></span>:
    print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">*</span><span style="color:#710">'</span></span> * <span style="color:#00D">40</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Calling snooze(.123)</span><span style="color:#710">'</span></span>)
    snooze(<span style="color:#60E">.123</span>)
    print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">*</span><span style="color:#710">'</span></span> * <span style="color:#00D">40</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Calling factorial(5)</span><span style="color:#710">'</span></span>)
    print(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">5! =</span><span style="color:#710">'</span></span>, factorial(<span style="color:#00D">5</span>))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Результат выполнения</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">PS C:\Users\User\PycharmProjects\Python. Design patterns and other\source&gt; py .\clock_decorator_demo.py
**************************************** Calling snooze(.123)
[0.13673660] snooze(0.123 -&gt; None)
**************************************** Calling factorial(5)
[0.00000120] factorial(1 -&gt; 1)
[0.00017130] factorial(2 -&gt; 2)
[0.00031230] factorial(3 -&gt; 6)
[0.00047800] factorial(4 -&gt; 24)
[0.00066200] factorial(5 -&gt; 120)
5! = 120</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_декораторы_в_стандартной_библиотеке">Декораторы в стандартной библиотеке</h3>
<div class="paragraph">
<p>Два самых любопытных декоратора в стандартной библиотеке - <code>lru_cache</code> и совсем новый <code>singledispatch</code> <em>(Python &gt;= 3.4)</em>, оба определены в <code>functools</code>.</p>
</div>
<div class="sect3">
<h4 id="_кэширование_с_помощью_functools_lru_cache">Кэширование с помощью <code>functools.lru_cache</code></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Декоратор <code>functools.lru_cache</code> очень полезен на практике</div>
Он реализует "запоминание" (memorization): прием оптимизации, смысл которого заключается в запоминании дорогостоящих вычислений, позволяет избежать повторных вычислений с теми же аргументами, что и раньше.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Пример использования кэширования</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">functools</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">contextlib</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">redirect_stdout</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">clock_decorator</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">clock</span>


<span style="color:#777">#@functools.lru_cache()</span>
<span style="color:#B0B">@clock</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">fibonacci</span>(n):
    <span style="color:#080;font-weight:bold">if</span> n &lt; <span style="color:#00D">2</span>:
        <span style="color:#080;font-weight:bold">return</span> n
    <span style="color:#080;font-weight:bold">return</span> fibonacci(n-<span style="color:#00D">2</span>) + fibonacci(n-<span style="color:#00D">1</span>)


<span style="color:#080;font-weight:bold">if</span> __name__ == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">__main__</span><span style="color:#710">'</span></span>:
    <span style="color:#080;font-weight:bold">with</span> <span style="color:#369;font-weight:bold">open</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./doctest/fibo_demo_out.txt</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">a</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">as</span> f:
        <span style="color:#080;font-weight:bold">with</span> redirect_stdout(f):
            print(fibonacci(<span style="color:#00D">10</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>На примере функция уже декорирована. Для сравнения, вот выводы декорированной и не декорированной функции <code>fibonacci</code>:</p>
</div>
<div class="listingblock">
<div class="title">Вывод скрипта без использования <code>lru_cache</code>. Очевидны лишние вычисления.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[0.00000050] fibonacci(0 -&gt; 0)
[0.00000040] fibonacci(1 -&gt; 1)
[0.00003930] fibonacci(2 -&gt; 1)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00000030] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000870] fibonacci(2 -&gt; 1)
[0.00001650] fibonacci(3 -&gt; 2)
[0.00006430] fibonacci(4 -&gt; 3)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000720] fibonacci(2 -&gt; 1)
[0.00001430] fibonacci(3 -&gt; 2)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00000710] fibonacci(2 -&gt; 1)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00000240] fibonacci(0 -&gt; 0)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00001180] fibonacci(2 -&gt; 1)
[0.00001890] fibonacci(3 -&gt; 2)
[0.00003320] fibonacci(4 -&gt; 3)
[0.00005450] fibonacci(5 -&gt; 5)
[0.00012600] fibonacci(6 -&gt; 8)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000730] fibonacci(2 -&gt; 1)
[0.00001410] fibonacci(3 -&gt; 2)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000710] fibonacci(2 -&gt; 1)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00000700] fibonacci(2 -&gt; 1)
[0.00001380] fibonacci(3 -&gt; 2)
[0.00002810] fibonacci(4 -&gt; 3)
[0.00004980] fibonacci(5 -&gt; 5)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000710] fibonacci(2 -&gt; 1)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000710] fibonacci(2 -&gt; 1)
[0.00001460] fibonacci(3 -&gt; 2)
[0.00002830] fibonacci(4 -&gt; 3)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000030] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000720] fibonacci(2 -&gt; 1)
[0.00001410] fibonacci(3 -&gt; 2)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000740] fibonacci(2 -&gt; 1)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000050] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000810] fibonacci(2 -&gt; 1)
[0.00001680] fibonacci(3 -&gt; 2)
[0.00003080] fibonacci(4 -&gt; 3)
[0.00005170] fibonacci(5 -&gt; 5)
[0.00008660] fibonacci(6 -&gt; 8)
[0.00014380] fibonacci(7 -&gt; 13)
[0.00027750] fibonacci(8 -&gt; 21)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00000030] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000700] fibonacci(2 -&gt; 1)
[0.00001400] fibonacci(3 -&gt; 2)
[0.00000030] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000710] fibonacci(2 -&gt; 1)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000890] fibonacci(2 -&gt; 1)
[0.00001620] fibonacci(3 -&gt; 2)
[0.00003080] fibonacci(4 -&gt; 3)
[0.00005150] fibonacci(5 -&gt; 5)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000720] fibonacci(2 -&gt; 1)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00002470] fibonacci(2 -&gt; 1)
[0.00003160] fibonacci(3 -&gt; 2)
[0.00004530] fibonacci(4 -&gt; 3)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000700] fibonacci(2 -&gt; 1)
[0.00001380] fibonacci(3 -&gt; 2)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000700] fibonacci(2 -&gt; 1)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00001540] fibonacci(2 -&gt; 1)
[0.00002220] fibonacci(3 -&gt; 2)
[0.00003610] fibonacci(4 -&gt; 3)
[0.00005660] fibonacci(5 -&gt; 5)
[0.00010850] fibonacci(6 -&gt; 8)
[0.00016680] fibonacci(7 -&gt; 13)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00000730] fibonacci(2 -&gt; 1)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000710] fibonacci(2 -&gt; 1)
[0.00001430] fibonacci(3 -&gt; 2)
[0.00002820] fibonacci(4 -&gt; 3)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000700] fibonacci(2 -&gt; 1)
[0.00001410] fibonacci(3 -&gt; 2)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000700] fibonacci(2 -&gt; 1)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000700] fibonacci(2 -&gt; 1)
[0.00001390] fibonacci(3 -&gt; 2)
[0.00002730] fibonacci(4 -&gt; 3)
[0.00004810] fibonacci(5 -&gt; 5)
[0.00008580] fibonacci(6 -&gt; 8)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000830] fibonacci(2 -&gt; 1)
[0.00001530] fibonacci(3 -&gt; 2)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000710] fibonacci(2 -&gt; 1)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000730] fibonacci(2 -&gt; 1)
[0.00001580] fibonacci(3 -&gt; 2)
[0.00003140] fibonacci(4 -&gt; 3)
[0.00005330] fibonacci(5 -&gt; 5)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000710] fibonacci(2 -&gt; 1)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000030] fibonacci(1 -&gt; 1)
[0.00000700] fibonacci(2 -&gt; 1)
[0.00001440] fibonacci(3 -&gt; 2)
[0.00002800] fibonacci(4 -&gt; 3)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000020] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000730] fibonacci(2 -&gt; 1)
[0.00001400] fibonacci(3 -&gt; 2)
[0.00000030] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000930] fibonacci(2 -&gt; 1)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00000030] fibonacci(0 -&gt; 0)
[0.00000020] fibonacci(1 -&gt; 1)
[0.00003070] fibonacci(2 -&gt; 1)
[0.00003770] fibonacci(3 -&gt; 2)
[0.00005370] fibonacci(4 -&gt; 3)
[0.00007440] fibonacci(5 -&gt; 5)
[0.00010920] fibonacci(6 -&gt; 8)
[0.00016910] fibonacci(7 -&gt; 13)
[0.00026170] fibonacci(8 -&gt; 21)
[0.00043520] fibonacci(9 -&gt; 34)
[0.00072080] fibonacci(10 -&gt; 55)
55</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Вывод скрипта c <code>lru_cache</code>.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[0.00000140] fibonacci(0 -&gt; 0)
[0.00000040] fibonacci(1 -&gt; 1)
[0.00005920] fibonacci(2 -&gt; 1)
[0.00000070] fibonacci(3 -&gt; 2)
[0.00007080] fibonacci(4 -&gt; 3)
[0.00000060] fibonacci(5 -&gt; 5)
[0.00008260] fibonacci(6 -&gt; 8)
[0.00000060] fibonacci(7 -&gt; 13)
[0.00009310] fibonacci(8 -&gt; 21)
[0.00000070] fibonacci(9 -&gt; 34)
[0.00010440] fibonacci(10 -&gt; 55)
55</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>lru_cache</code> необходимо вызывать как функцию со скобками. <code>functools.lru_cache()</code>. Причина в том, что декоратор принимает конфигурационные параметры.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Полная сигнатура</div>
<code>functools.lru_cache(max_size=128, typed=False)</code>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>maxsize</code>&#8201;&#8212;&#8201;сколько результатов хранить (<em>для достижения результата maxsize = n<sup>2</sup></em>).</p>
</li>
<li>
<p><code>type</code> - если стоит True, то результаты разных типов будут храниться порознь.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_одиночная_диспетчеризация_и_обобщенные_функции">Одиночная диспетчеризация и обобщенные функции</h3>
<div class="paragraph">
<p><code>functools.singledispatch</code> - (Python &gt;= 3.4) позволяет каждому модулю вносить свой вклад в общее решение, так, что пользователь может легко добавить специализированную функцию, даже не имея возможности изменить класс.</p>
</div>
<div class="paragraph">
<p>Обычная функция, декорированная <code>singledispatch</code> становится <em>обобщенной функцией</em>: группой функций, выполняющих одну и ту же логическую операцию по-разному в зависимости от типа первого аргумента.</p>
</div>
<div class="listingblock">
<div class="title">Декоратор <code>functools.singledispatch</code> создает функцию <code>htmlize.register</code> для объединения нескольких функций в одну обобщенную.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">collections</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">abc</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">html</span>
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">numbers</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#B44;font-weight:bold">functools</span> <span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">singledispatch</span>


<span style="color:#B0B">@singledispatch</span>             <span style="color:#777"># Помечает базовую функцию, которая обрабатывает obj</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">htmlize</span>(obj):
    content = html.escape(<span style="color:#369;font-weight:bold">repr</span>(obj))
    <span style="color:#080;font-weight:bold">return</span> f<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;pre&gt;{content}&lt;/pre&gt;</span><span style="color:#710">'</span></span>


<span style="color:#B0B">@htmlize.register</span>(<span style="color:#369;font-weight:bold">str</span>)      <span style="color:#777"># Каждая специальная функция снабжается декоратором</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">_</span>(text):                <span style="color:#777"># Имена функций не существенны</span>
    content = html.escape(text).replace(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#b0b">\n</span><span style="color:#710">'</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;br&gt;</span><span style="color:#b0b">\n</span><span style="color:#710">'</span></span>)
    <span style="color:#080;font-weight:bold">return</span> f<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;pre&gt;{content}&lt;/pre&gt;</span><span style="color:#710">'</span></span>


<span style="color:#B0B">@htmlize.regiter</span>(numbers.Integral)
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">_</span>(n):
    <span style="color:#080;font-weight:bold">return</span> f<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;pre&gt;{n} (0x{0:x})&lt;/pre&gt;</span><span style="color:#710">'</span></span>


<span style="color:#B0B">@htmlize.register</span>(<span style="color:#369;font-weight:bold">tuple</span>)
<span style="color:#B0B">@htmlize.register</span>(abc.MutableSequence)
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">_</span>(seq):
    inner = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;/li&gt;</span><span style="color:#b0b">\n</span><span style="color:#D20">&lt;li&gt;</span><span style="color:#710">'</span></span>.join(htmlize(item) <span style="color:#080;font-weight:bold">for</span> item <span style="color:#080;font-weight:bold">in</span> seq)
    <span style="color:#080;font-weight:bold">return</span> f<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;ul&gt;</span><span style="color:#b0b">\n</span><span style="color:#D20">&lt;li&gt;{inner}&lt;/li&gt;</span><span style="color:#b0b">\n</span><span style="color:#D20">&lt;li&gt;</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Замечательное свойство данного декоратора в том, что специализированные функции можно зарегистрировать в любом месте системы, в любом модуле. Если в последствии, вы добавите модуль, содержащий новый пользовательский тип, то без труда сможете новую специализированную функцию для обработки данного типа.</p>
</div>
<div class="ulist">
<div class="title">Возможности этого декоратора шире, подробнее можно почитать тут:</div>
<ul>
<li>
<p><a href="https://www.python.org/dev/peps/pep-0443/">PEP-0443 Single-dispatch generic function</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_композиция_декораторов">Композиция декораторов</h3>
<div class="paragraph">
<p>Когда два декоратора <code>@d1</code> и <code>@d2</code> применяются к одной и той же функции <code>f</code> в указанном порядке, получается то же самое, что и в результате композиции <code>f=d1(d2(f))</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_параметризованные_декораторы">Параметризованные декораторы</h3>
<div class="paragraph">
<p>Для реализации параметризованного декоратора, необходимо создать <em>фабрику декораторов</em>. Т.е. создать функцию, которая возвращает декоратор.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ссылочки">Ссылочки</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://wrapt.readthedocs.io/en/latest/">A Python module for decorators, wrappers and monkey patching.</a></p>
</li>
<li>
<p><a href="https://pypi.org/project/decorator/">pip install decorator</a></p>
</li>
<li>
<p><a href="https://wiki.python.org/moin/PythonDecoratorLibrary">Python Decorator Library</a></p>
</li>
<li>
<p><a href="https://www.python.org/dev/peps/pep-0443/">PEP 443&#8201;&#8212;&#8201;Single-dispatch generic functions</a></p>
</li>
<li>
<p><a href="https://www.python.org/dev/peps/pep-3104/">PEP 3104&#8201;&#8212;&#8201;Access to Names in Outer Scopes</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ссылки_на_объекты">Ссылки на объекты</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Для правильного понимания присваивания в Python всегда сначала читайте правую часть, ту, где объект создается
или извлекается. Уже после этого переменная в левой части связывается с объектом&#8201;&#8212;&#8201;как приклеенная к нему этикетка.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Поскольку переменные&#8201;&#8212;&#8201;это просто этикетки, ничего не мешает наклеить на объект несколько этикеток. В этом случае
образуются <em>синонимы</em>.</p>
</div>
<div class="sect2">
<h3 id="_выбор_между_и_is">Выбор между <code>==</code> и <code>is</code></h3>
<div class="paragraph">
<p>Оператор <code>==</code> сравнивает значение объектов (хранящихся в нем данных), а оператор <code>is</code>&#8201;&#8212;&#8201;их <code>id</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_относительная_неизменность_кортежей">Относительная неизменность кортежей</h3>
<div class="paragraph">
<p>Кортежи, как и большинство коллекций в Python,&#8201;&#8212;&#8201;списки, словари, множества и т.д.&#8201;&#8212;&#8201;хранят ссылки на объекты.
Если элементы, на которые указывают ссылки, изменяемы, то их можно модифицировать, хотя сам кортеж останется неизменяемый.</p>
</div>
</div>
<div class="sect2">
<h3 id="_по_умолчанию_копирование_поверхностное">По умолчанию копирование поверхностное</h3>
<div class="paragraph">
<div class="title">Cоздание поверхностной копии списка, содержащий другой список;</div>
<p><span class="image"><img src="../docs/images/pythontutor.com_1.png" alt="pythontutor.com 1" width="900"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Теперь должно быть понятно, что создать поверхностную копию легко, но это не всегда то что нужно.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Для значений по умолчанию ( <code>def func( a=default )</code> ) необходимо устанавливать значение None, а не изменяемые пустые объекты типо <code>[]</code>.
Это может привести к изменению объекта установленного по умолчанию и во вновь созданных объектах будут фантомные
объекты.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Ошибка при назначении по умолчанию изменяемого объекта</div>
<p><span class="image"><img src="./images/pythontutor.com_2.png" alt="pythontutor.com 2" width="900"></span></p>
</div>
<div class="paragraph">
<p>При написании функции, принимающий изменяемый параметр, необходимо тщательно обдумывать, ожидает ли принимающая сторона,
что аргумент может быть изменён.</p>
</div>
<div class="paragraph">
<div class="title">Пример правильной реализации</div>
<p><span class="image"><img src="./images/pythontutor.com_3.png" alt="pythontutor.com 3" width="900"></span></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Важное замечание. В объекте автобуса при инициализации создается копия списка. Это исключает ошибки связанной с
изменением объекта переданного при инициализации.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">HauntedBuss</span>:
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">__init__</span>(<span style="color:#069">self</span>, passangers=<span style="color:#069">None</span>):
        <span style="color:#080;font-weight:bold">if</span> passangers <span style="color:#080;font-weight:bold">is</span> <span style="color:#069">None</span>:
            <span style="color:#069">self</span>.passangers = []
        <span style="color:#080;font-weight:bold">else</span>:
            <span style="color:#069">self</span>.passangers = <span style="color:#369;font-weight:bold">list</span>(passangers)
            <span style="color:#777"># Если тут сделать просто self.passangers = passangers,</span>
            <span style="color:#777"># эти объекты будут синонимами.</span>

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">pick</span>(<span style="color:#069">self</span>, name):
        <span style="color:#069">self</span>.passangers.append(name)

    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">drop</span>(<span style="color:#069">self</span>, name):
        <span style="color:#069">self</span>.passangers.remove(name)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">doctest для проверки корректного автобуса</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">&gt;&gt;&gt; from source.buss import HauntedBuss
&gt;&gt;&gt; bus1 = HauntedBuss(['Олеся', 'Артём'])
&gt;&gt;&gt; bus1.passangers
['Олеся', 'Артём']
&gt;&gt;&gt; bus1.pick('Антон')
&gt;&gt;&gt; bus1.drop('Олеся')
&gt;&gt;&gt; bus1.passangers
['Артём', 'Антон']
&gt;&gt;&gt; bus2 = HauntedBuss()
&gt;&gt;&gt; bus2.pick('Оксана')
&gt;&gt;&gt; bus2.passangers
['Оксана']
&gt;&gt;&gt; bus3 = HauntedBuss()
&gt;&gt;&gt; bus3.passangers
[]
&gt;&gt;&gt; footboal_team = ['Артем', 'Гриша', 'Пётр', 'Антон', 'Лакки']
&gt;&gt;&gt; bus4 = HauntedBuss(footboal_team)
&gt;&gt;&gt; bus4.passangers
['Артем', 'Гриша', 'Пётр', 'Антон', 'Лакки']
&gt;&gt;&gt; bus4.drop('Антон')
&gt;&gt;&gt; footboal_team
['Артем', 'Гриша', 'Пётр', 'Антон', 'Лакки']
&gt;&gt;&gt; bus4.passangers
['Артем', 'Гриша', 'Пётр', 'Лакки']</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Если сделать вот так:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span style="color:#069">self</span>.passangers = passangers</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">То футбольная команда потеряет одного игрока вместе с выходом из автобуса.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="doctest">doctest.testfile('./source/doctest/buss_correct.txt')
**********************************************************************
File &quot;.\source\doctest\buss_correct.txt&quot;, line 21, in buss_correct.txt
Failed example:
    footboal_team
Expected:
    ['Артем', 'Гриша', 'Пётр', 'Антон', 'Лакки']
Got:
    ['Артем', 'Гриша', 'Пётр', 'Лакки']
**********************************************************************
1 items had failures:
   1 of  17 in buss_correct.txt
***Test Failed*** 1 failures.
TestResults(failed=1, attempted=17)</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Визуализация потери игрока</div>
<p><span class="image"><img src="./images/pythontutor.com_4.png" alt="pythontutor.com 4" width="900"></span></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-12-16 14:18:40 +0600
</div>
</div>
</body>
</html>